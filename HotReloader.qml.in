import lovrencic.qtreload

import QtQuick

Loader {
    id: root
    readonly property url file: "file://@MAIN_HOT_RELOADABLE_QML_FILE_PATH@"
    source: file

    function reload(modifiedPath) {
        print(`[LOADER] load initiated (${modifiedPath})`);
        active = false;
        QmlEngineCacheManager.clearCache()
        source = file + "?reload=" + Date.now();
        active = true;
    }

    onLoaded: print(`[LOADER] load complete`)

    Watcher {
        id: watcher
        paths: [@HOT_RELOADABLE_QML_FILE_PATHS@]
        // paths: ["/home/rudolf/dev/qtreload/content"]
        onFileModified: modifiedFile => root.reload(modifiedFile)
        onDirectoryModified: modifiedDirectory => root.reload(modifiedDirectory)
    }

}
